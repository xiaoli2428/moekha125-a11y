<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Multi Timezone Digital Clock</title>
  <style>
    :root{
      --bg:#071124;
      --card:#0b1220;
      --accent:#06b6d4;
      --muted:#94a3b8;
      --text:#e6eef6;
    }
    body{
      margin:0;
      min-height:100vh;
      background:linear-gradient(180deg,var(--bg),#041122 120%);
      color:var(--text);
      font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,"Helvetica Neue",Arial;
      display:flex;
      align-items:flex-start;
      justify-content:center;
      padding:24px;
      box-sizing:border-box;
    }

    .app {
      width:100%;
      max-width:980px;
    }

    header {
      display:flex;
      gap:12px;
      align-items:center;
      margin-bottom:16px;
      flex-wrap:wrap;
    }

    h1 {
      font-size:18px;
      margin:0;
      color:var(--text);
    }

    .controls {
      margin-left:auto;
      display:flex;
      gap:8px;
      align-items:center;
    }

    select,input[type="text"]{
      padding:8px 10px;
      border-radius:8px;
      border:1px solid rgba(255,255,255,0.04);
      background:rgba(255,255,255,0.02);
      color:var(--muted);
      min-width:220px;
    }

    button {
      padding:8px 10px;
      border-radius:8px;
      border:0;
      background:linear-gradient(90deg,var(--accent),#60a5fa);
      color:#042027;
      font-weight:600;
      cursor:pointer;
    }

    .grid {
      display:grid;
      grid-template-columns: repeat(auto-fill,minmax(220px,1fr));
      gap:12px;
    }

    .card {
      background: linear-gradient(180deg, rgba(255,255,255,0.015), rgba(255,255,255,0.01));
      padding:12px;
      border-radius:10px;
      border:1px solid rgba(255,255,255,0.02);
      min-height:80px;
      box-sizing:border-box;
      position:relative;
    }

    .tz {
      display:flex;
      justify-content:space-between;
      align-items:center;
      gap:8px;
    }

    .name { font-weight:700; color:#dbeafe; font-size:14px; }
    .meta { color:var(--muted); font-size:12px; }

    .time { font-family: ui-monospace,SFMono-Regular,Menlo,Monaco,"Roboto Mono",monospace; font-size:20px; margin-top:8px; color:#f0f9ff; }
    .date { font-size:12px; color:var(--muted); margin-top:4px; }

    .remove {
      background:transparent;
      border:0;
      color:var(--muted);
      font-size:18px;
      line-height:1;
      cursor:pointer;
    }

    .footer {
      margin-top:14px;
      color:var(--muted);
      font-size:13px;
    }

    .small {
      font-size:12px;
      color:var(--muted);
    }

    .settings { display:flex; gap:8px; align-items:center; }
    label { color:var(--muted); font-size:13px; display:flex; gap:8px; align-items:center; }
    input[type="checkbox"] { transform:scale(1.1); }

    @media (max-width:520px){
      header { flex-direction:column; align-items:flex-start; gap:10px; }
      .controls { margin-left:0; }
    }
  </style>
</head>
<body>
  <div class="app" id="app" role="application" aria-label="Multi timezone digital clocks">
    <header>
      <h1>Multi Timezone Digital Clock</h1>

      <div class="controls" aria-hidden="false">
        <select id="tzSelect" aria-label="Select timezone">
          <!-- Options populated by JS -->
        </select>

        <button id="addBtn">Add</button>

        <div class="settings" style="margin-left:8px">
          <label title="Use 12-hour clock">
            <input id="hour12Toggle" type="checkbox" /> 12-hour
          </label>
          <label title="Locale: auto uses browser locale">
            <select id="localeSelect" style="min-width:140px">
              <option value="auto">auto (browser)</option>
              <option value="en-US">en-US</option>
              <option value="en-GB">en-GB</option>
              <option value="fr-FR">fr-FR</option>
              <option value="de-DE">de-DE</option>
            </select>
          </label>
        </div>
      </div>
    </header>

    <main>
      <section class="grid" id="grid" aria-live="polite">
        <!-- Clocks go here -->
      </section>
      <div class="footer small">
        Tip: Open the page in multiple tabs to test persistence and manual cross-tab sync.
      </div>
    </main>
  </div>

  <script>
    // A practical subset of common IANA timezones for the dropdown
    const TIMEZONES = [
      "UTC",
      "America/Los_Angeles","America/Denver","America/Chicago","America/New_York",
      "America/Sao_Paulo","America/Toronto",
      "Europe/London","Europe/Paris","Europe/Berlin","Europe/Madrid","Europe/Moscow",
      "Asia/Dubai","Asia/Kolkata","Asia/Shanghai","Asia/Tokyo","Asia/Seoul","Asia/Singapore",
      "Australia/Sydney","Pacific/Auckland","Pacific/Honolulu","Africa/Johannesburg"
    ];

    const STORAGE_KEY = "multiClock:zones_simple";
    const HOUR12_KEY = "multiClock:hour12_simple";
    // Simple persistence keys (separate from prior, so we don't conflict)

    const grid = document.getElementById("grid");
    const tzSelect = document.getElementById("tzSelect");
    const addBtn = document.getElementById("addBtn");
    const hour12Toggle = document.getElementById("hour12Toggle");
    const localeSelect = document.getElementById("localeSelect");

    // Populate timezone select
    (function populateSelect(){
      for(const tz of TIMEZONES){
        const opt = document.createElement("option");
        opt.value = tz;
        opt.textContent = tz.replace("_"," ");
        tzSelect.appendChild(opt);
      }
    })();

    // Load saved zones from localStorage or default list
    function loadSavedZones(){
      try {
        const raw = localStorage.getItem(STORAGE_KEY);
        if(!raw) return ["UTC","America/New_York","Europe/London","Asia/Tokyo"];
        const parsed = JSON.parse(raw);
        if(Array.isArray(parsed) && parsed.length) return parsed;
      } catch(e){}
      return ["UTC","America/New_York","Europe/London","Asia/Tokyo"];
    }

    // Save zones
    function saveZones(zones){
      try { localStorage.setItem(STORAGE_KEY, JSON.stringify(zones)); } catch(e){}
    }

    // Load hour12 preference
    function loadHour12(){
      try { return localStorage.getItem(HOUR12_KEY) === "1"; } catch(e) { return false; }
    }

    function saveHour12(val){
      try { localStorage.setItem(HOUR12_KEY, val ? "1" : "0"); } catch(e){}
    }

    // Effective locale (undefined for Intl uses browser default)
    function effectiveLocale(){
      const val = localeSelect.value;
      return (!val || val === "auto") ? undefined : val;
    }

    // Format helpers
    function formatDateTime(date, tz, hour12){
      try {
        const timeFormatter = new Intl.DateTimeFormat(effectiveLocale(), {
          timeZone: tz,
          hour: "2-digit",
          minute: "2-digit",
          second: "2-digit",
          hour12: !!hour12
        });
        const dateFormatter = new Intl.DateTimeFormat(effectiveLocale(), {
          timeZone: tz,
          weekday: "short",
          year: "numeric",
          month: "short",
          day: "2-digit"
        });
        return { time: timeFormatter.format(date), date: dateFormatter.format(date) };
      } catch (e){
        return { time: "Invalid TZ", date: "" };
      }
    }

    // Create card element for a timezone
    function createCard(tz){
      const card = document.createElement("section");
      card.className = "card";
      card.dataset.tz = tz;

      const tzRow = document.createElement("div");
      tzRow.className = "tz";

      const left = document.createElement("div");
      left.style.display = "flex";
      left.style.flexDirection = "column";

      const name = document.createElement("div");
      name.className = "name";
      name.textContent = tz;

      const meta = document.createElement("div");
      meta.className = "meta";
      meta.textContent = tzMetaForNow(tz);

      left.appendChild(name);
      left.appendChild(meta);

      const removeBtn = document.createElement("button");
      removeBtn.className = "remove";
      removeBtn.setAttribute("aria-label", `Remove ${tz}`);
      removeBtn.textContent = "Ã—";
      removeBtn.addEventListener("click", () => {
        removeZone(tz);
      });

      tzRow.appendChild(left);
      tzRow.appendChild(removeBtn);

      const timeDiv = document.createElement("div");
      timeDiv.className = "time";
      timeDiv.textContent = "";

      const dateDiv = document.createElement("div");
      dateDiv.className = "date";
      dateDiv.textContent = "";

      card.appendChild(tzRow);
      card.appendChild(timeDiv);
      card.appendChild(dateDiv);
      return card;
    }

    // Time zone meta (short tz name, best-effort)
    function tzMetaForNow(tz){
      try {
        const parts = new Intl.DateTimeFormat(effectiveLocale(), { timeZone: tz, timeZoneName: "short" }).formatToParts(new Date());
        const part = parts.find(p => p.type === "timeZoneName");
        return part ? part.value : tz;
      } catch(e){
        return tz;
      }
    }

    // Rendering and state
    let zones = loadSavedZones();
    hour12Toggle.checked = loadHour12();
    // default locale selection remains at "auto"

    function renderGrid(){
      grid.innerHTML = "";
      for(const tz of zones){
        const card = createCard(tz);
        grid.appendChild(card);
      }
      // force immediate update
      tick();
    }

    function addZone(tz){
      if(!tz) return;
      if(zones.includes(tz)) return;
      zones.unshift(tz); // recent-first
      saveZones(zones);
      renderGrid();
    }

    function removeZone(tz){
      zones = zones.filter(z=>z!==tz);
      saveZones(zones);
      renderGrid();
    }

    addBtn.addEventListener("click", ()=>{
      addZone(tzSelect.value);
    });

    // hour12 toggle
    hour12Toggle.addEventListener("change", ()=>{
      saveHour12(hour12Toggle.checked);
      tick(); // update displays immediately
    });

    localeSelect.addEventListener("change", ()=>{
      tick();
    });

    // Update all clocks each second
    function tick(){
      const now = new Date();
      const hour12 = hour12Toggle.checked;
      for(const card of grid.children){
        const tz = card.dataset.tz;
        const display = formatDateTime(now, tz, hour12);
        card.querySelector(".time").textContent = display.time;
        card.querySelector(".date").textContent = display.date;
        // update tz meta in case DST or locale changed
        const meta = card.querySelector(".meta");
        if(meta) meta.textContent = tzMetaForNow(tz);
      }
    }

    // Cross-tab basic sync: listen for storage changes to our keys
    window.addEventListener("storage", (e)=>{
      if(!e) return;
      if(e.key === STORAGE_KEY){
        // load and re-render
        zones = loadSavedZones();
        renderGrid();
      } else if(e.key === HOUR12_KEY){
        hour12Toggle.checked = loadHour12();
        tick();
      }
    });

    // Start ticking
    renderGrid();
    tick();
    setInterval(tick, 1000);

    // Simple keyboard accessibility: add zone on Enter when select focused
    tzSelect.addEventListener("keydown", (ev)=>{
      if(ev.key === "Enter") addZone(tzSelect.value);
    });
  </script>
</body>
</html>